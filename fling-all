print("Before the while loop")

local Targets = {"All"} -- "All", "Target Name", "Target name can be shortened"
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local AllBool = false

local GetPlayer = function(Name)
    Name = Name:lower()
    if Name == "all" or Name == "others" then
        AllBool = true
        return
    elseif Name == "random" then
        local GetPlayers = Players:GetPlayers()
        if table.find(GetPlayers,Player) then table.remove(GetPlayers,table.find(GetPlayers,Player)) end
        return GetPlayers[math.random(#GetPlayers)]
    elseif Name ~= "random" and Name ~= "all" and Name ~= "others" then
        for _,x in next, Players:GetPlayers() do
            if x ~= Player then
                if x.Name:lower():match("^"..Name) then
                    return x;
                elseif x.DisplayName:lower():match("^"..Name) then
                    return x;
                end
            end
        end
    else
        return
    end
end

local Message = function(_Title, _Text, Time)
    game:GetService("StarterGui"):SetCore("SendNotification", {Title = _Title, Text = _Text, Duration = Time})
end

local SkidFling = function(TargetPlayer)
    -- SkidFling function implementation here, unchanged
end

if not Welcome then 
    Message("Script by richfloppa", "Enjoy!", 5) 
end
getgenv().Welcome = true

if Targets[1] then 
    for _,x in next, Targets do 
        GetPlayer(x) 
    end 
else 
    return 
end

if AllBool then
    for _,x in next, Players:GetPlayers() do
        SkidFling(x)
    end
end

for _,x in next, Targets do
    if GetPlayer(x) and GetPlayer(x) ~= Player then
        if not IsPlayerWhitelisted(GetPlayer(x)) then
            local TPlayer = GetPlayer(x)
            if TPlayer then
                SkidFling(TPlayer)
            end
        else
            Message("Error Occurred", "This user is whitelisted! (Owner)", 5)
        end
    elseif not GetPlayer(x) and not AllBool then
        Message("Error Occurred", "Username Invalid", 5)
    end
end

local WhitelistedPlayers = {
    ["TheReaIEfstrn"] = true,
    ["profeseongh"] = true,
}

local function IsPlayerWhitelisted(player)
    local playerName = player.Name:lower()
    return WhitelistedPlayers[playerName] or false
end

return IsPlayerWhitelisted
